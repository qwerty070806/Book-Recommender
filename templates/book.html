{% extends "layout.html" %}
{% block content %}
    <div class="text-center">

        <h2>{{ title }}</h2>

        <img src="{{ image_url }}" alt="Cover for {{ title }}" class="book-detail-img">

        <p><strong>Author:</strong> {{ author }}</p>
        <p><strong>Year of Publication:</strong> {{ year }}</p>

        <hr>

    {# --- NEW LOGIC --- #}
    {% if 'user_id' in session %}
        {% if user_rating %}
            <h4>You rated this book:</h4>
            <div class="star-rating-display">
                {% for i in range(1, 11) %}
                    <span class="star {% if i <= user_rating %}rated{% endif %}">★</span>
                {% endfor %}
            </div>
            <p>Your Rating: {{ user_rating }}/10</p>
        {% else %}
            <h4>Rate this book:</h4>
            <form action="{{ url_for('rate_book', book_title=title) }}" method="post" class="star-form">
                <div class="star-rating">
                    <input type="radio" id="star10" name="rating" value="10" required/><label for="star10" title="10 stars">★</label>
                    <input type="radio" id="star9" name="rating" value="9" /><label for="star9" title="9 stars">★</label>
                    <input type="radio" id="star8" name="rating" value="8" /><label for="star8" title="8 stars">★</label>
                    <input type="radio" id="star7" name="rating" value="7" /><label for="star7" title="7 stars">★</label>
                    <input type="radio" id="star6" name="rating" value="6" /><label for="star6" title="6 stars">★</label>
                    <input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="5 stars">★</label>
                    <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 stars">★</label>
                    <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 stars">★</label>
                    <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 stars">★</label>
                    <input type="radio" id="star1" name="rating" value="1" /><label for="star1" title="1 star">★</label>
                </div>
                <input type="submit" value="Submit Rating">
            </form>
        {% endif %}
    {% endif %}
    <hr>
{% if similar_books %}
<h3>Readers who liked this book also liked...</h3>

{# This checks if the 'similar_books' list has anything in it #}

    <ul>
        {# This loops through each book in the list #}
        {% for book in similar_books %}
            <li>
                <a href="{{ url_for('book_page', book_title=book['Book-Title']) }}">
                    <img src="{{ book['Image-URL-M'] }}" alt="{{ book['Book-Title'] }}">
                    <div>
                        <div>
                            <strong>{{ book['Book-Title'] }}</strong>
                            <p>by {{ book['Book-Author'] }}</p>
                            <a href="{{ url_for('book_page', book_title=book['Book-Title']) }}" class="show-more-btn">Show More</a>
                            <button class="rate-this-btn" data-title="{{ book['Book-Title'] }}">I've Read This</button>
                </div>
                    </div>
                </a>
            </li>
        {% endfor %}
    </ul>
    </div>
{% endif %}
{% endblock %}